programs = xmlparser calc test_special showdefs
version = 0.0.1-a
compiler = g++
ctags = ctags
args = 
libs = -ldpl
OS_AUTO = $(shell uname -s)
COMMENT = _

#OS_LINUXobjects = 
#OS_MACobjects = 

default:
	echo "Use: make config, make build, make install, make clean, and if you don't like it make uninstall."

phony: config build install uninstall clean tags

config: include/config.hpp
ifeq ($(OS),linux)
	sed -e "s/#OS$(COMMENT)LINUX//g" Makefile.in > Makefile
else
ifeq ($(OS),osx)
	sed -e "s/#OS$(COMMENT)MAC//g" Makefile.in > Makefile
else
ifeq ($(OS_AUTO),Linux)
	sed -e "s/#OS$(COMMENT)LINUX//g" Makefile.in > Makefile
else
ifeq ($(OS_AUTO),Darwin)
	sed -e "s/#OS$(COMMENT)MAC//g" Makefile.in > Makefile
else
	echo "Unable to recognize os $(OS_AUTO)."
	echo "If linux is used please run"
	echo "OS=linux make config."
	echo "If OS X is used please run"
	echo "OS=osx make config."
	cp Makefile.in Makefile
endif
endif
endif
endif

build: $(programs)


include/config.hpp: Makefile
	echo "// Autogenerated configuration file" > include/config.hpp
	echo "#ifndef CONFIG_HPP" >> include/config.hpp
	echo "#define CONFIG_HPP" >> include/config.hpp
#OS_MAC	echo "#define OS_MAC" >> include/config.hpp
#OS_LINUX	echo "#define OS_LINUX" >> include/config.hpp
#OS_WIN	echo "#define OS_WIN" >> include/config.hpp
#GLOOX_VER_0.8.8	echo "#define GLOOX_0_8_8" >> include/config.hpp
#GLOOX_VER_0.9.0	echo "#define GLOOX_0_9_0" >> include/config.hpp
#GLOOX_VER_0.9.6	echo "#define GLOOX_0_9_6" >> include/config.hpp
	echo "#endif" >> include/config.hpp

clean:
	mkdir -p objects
	mkdir -p include
	touch clean~
	touch packages
	touch objects/clean.o
	touch include/config.hpp
	touch $(programs)
	rm *~
	rm -Rf packages
	rm objects/*.o
	rm include/config.hpp
	rm $(programs)
	cp Makefile.in Makefile

objects/%.o: source/%.cpp include/*.hpp include/config.hpp
	mkdir -p objects
	$(compiler) -c source/$*.cpp $(args) -o objects/$*.o

xmlparser: $(objects) objects/xmlparser.o include/config.hpp
	$(compiler) objects/xmlparser.o $(objects) -o xmlparser $(args) $(libs)

calc: $(objects) objects/calc.o include/config.hpp
	$(compiler) objects/calc.o $(objects) -o calc $(args) $(libs)

test_special: $(objects) objects/test_special.o include/config.hpp
	$(compiler) objects/test_special.o $(objects) -o test_special $(args) $(libs)

showdefs: $(objects) objects/showdefs.o include/config.hpp
	$(compiler) objects/showdefs.o $(objects) -o showdefs $(args) $(libs)

tags: include/*.hpp source/*.cpp
	$(ctags) -a -o ~/.ctags $(PWD)/include/* $(PWD)/source/*

